name: Test
description: "Test code base"

inputs:
  use-server-rc:
    required: false
    default: "false"
    description: "Test against server release candidate?"

runs:
  using: "composite"
  steps:
    - name: Run EE server
      uses: ./.github/actions/run-ee-server
      with:
        use-server-rc: ${{ inputs.use-server-rc }}
        docker-hub-username: ${{ secrets.DOCKER_HUB_BOT_USERNAME }}
        docker-hub-password: ${{ secrets.DOCKER_HUB_BOT_PW }}

    - name: Test
      run: dotnet exec .\AerospikeTest\bin\Release\net8.0\AerospikeTest.dll --settings .\test.runsettings
    
    - name: Show logs if failed
      if: ${{ failure() }}
      run: |
        docker container logs aerospike
        cat ./configs/aerospike.conf
